
// This file has been autogenerated by configure.py please modify config_*.py
// files and run configure.py instead of modifying this file.

#ifndef COMMUNICATION_H_
#define COMMUNICATION_H_

#include <stdint.h>
#include "array.hpp"
#include "config.h"
#include <string.h>

typedef uint8_t Address_t;

typedef struct {
	uint8_t dest;
	uint8_t src;
	uint8_t data[14];
} Packet_t;

struct{
	Address_t dest, src;
	char* msg;
}

class Communication {
public:
	Address_t src;

	Communication(Address_t src);
	
	// Get new packets in input queue and return nb of packets in input queue.
	virtual unsigned char fetchPackets(void);

	// return nb of packets in input queue.
	unsigned char pendingInputs(void);

	// get packet from input queue.
	Packet_t get(void);

	// send packet and return nb of byte written 
	virtual size_t send(const Packet_t* packet);
};


class Rooter : public Communication {
private:
	unsigned char readNewPacketsFromUART(Queue_t* queue);
	unsigned char readNewPacketsFromI2C(Queue_t* queue);

public:
	Rooter(Address_t src);
	unsigned char fetchPackets(void);
	size_t send(const Packet_t* packet);
};


class Module : public Communication {
private:
	unsigned char readNewPacketsFromI2C(Queue_t* queue);

public:
	Module(Address_t src);
	unsigned char pendingOutputs(void);
	unsigned char fetchPackets(void);
	size_t send(const Packet_t* packet);
};

#endif
